<!-- arcadia-ui-style:v2 -->
<link rel="stylesheet" href="/ui-static/arcadia_theme.css">

<!-- Shared application header -->
<header class="tm-header t-header">
  <div class="tm-container">
    <a class="tm-brand" href="{{ brand_home_url or '/' }}">
      {% if brand_logo_url %}<img src="{{ brand_logo_url }}" alt="logo" style="height:22px;vertical-align:middle;margin-right:8px;"/>{% endif %}
      {{ brand_name or 'Project Name' }}<small>{{ brand_tag or '' }}</small>
    </a>
    <div class="tm-right"> 
      {% set _nav = nav_items if (nav_items is defined) else [] %}
      {% if _nav and _nav|length > 0 %}
        <nav class="tm-nav" aria-label="Primary"> 
          {% for it in _nav %}
            <a href="{{ it.href }}" class="tm-link{% if it.active %} active{% endif %}">{{ it.label }}</a>
          {% endfor %}
        </nav>
      {% endif %}
      {% if request and request.state and request.state.user %} 
        <div class="tm-user" id="tm-user">
          <button class="tm-user-btn" id="tm-user-btn">Account â–¾</button>
          <div class="tm-user-menu" id="tm-user-menu">
            <button class="tm-menu-trigger" id="theme-menu-trigger">Theme</button>
            <div id="theme-submenu" style="display:none; position:absolute; right: 100%; top: 0; z-index: 3000;"></div>
            <a href="/profile">Profile</a>
            <a href="/settings">Settings</a>
            <hr />
            <a href="/auth/logout">Log out</a>
          </div>
        </div>
      {% else %}
        <div class="tm-actions">
          <a href="/login" class="tm-btn">Log in</a>
          <a href="/signup" class="tm-btn tm-primary">Sign up</a>
        </div>
      {% endif %}
    </div>
  </div>
</header>
<!-- Dropdown uses CSS :focus-within; no JS needed -->
<script src="/ui-static/theme-selector.js"></script>
{% set __persist = persist_header if persist_header is defined else true %}
{% if __persist %}
<script src="https://unpkg.com/htmx.org@1.9.12" integrity="sha384-+bVsx3b8QdE7cO1S4oFQ9hQ1TImfQxWqS4LzJd8j3jL5uFQw8L7f3NfL2hJdJg9w" crossorigin="anonymous"></script>
<script>
// Enable header persistence via htmx: boost links/forms and swap only #arcadia-content
(function(){
  try{
    var b=document.body; if(!b) return;
    b.setAttribute('hx-boost','true');
    b.setAttribute('hx-target','#arcadia-content');
    b.setAttribute('hx-select','#arcadia-content');
    b.setAttribute('hx-swap','innerHTML');
    b.setAttribute('hx-push-url','true');
  }catch(e){}
})();
</script>
<!-- App-neutral UI re-init event; apps can hook `ui:reinit` to (re)initialize features -->
<script>
(function(){
  try{
    function fire(){
      try{ window.dispatchEvent(new CustomEvent('ui:reinit')); }catch(e){}
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', fire, { once: true });
    } else {
      fire();
    }
    try{ document.body.addEventListener('htmx:afterSwap', fire); }catch(e){}
    document.addEventListener('visibilitychange', function(){ if(document.visibilityState==='visible') fire(); });
  }catch(e){}
})();
</script>
{% endif %}
        