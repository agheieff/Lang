
<!-- Shared header styled like Trading MMO -->
<style>
  :root { scrollbar-gutter: stable; }
  .tm-header, .tm-header *, .tm-header *::before, .tm-header *::after { box-sizing: border-box; }
  .tm-header { background:#111827; color:#e5e7eb; border-bottom:1px solid #1f2937; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif; font-size:14px; line-height:1.25; }
  .tm-header .tm-container { max-width:1200px; margin:0 auto; padding:0.75rem 1rem; display:flex; align-items:center; justify-content:space-between; }
  @media (min-width: 640px){ .tm-header .tm-container { min-height:56px; } }
  .tm-header .tm-brand { color:#f9fafb; font-weight:600; text-decoration:none; letter-spacing:0.2px; font-size:18px; }
  .tm-header .tm-nav a { color:#9ca3af; text-decoration:none; margin-left:1rem; font-size:14px; }
  .tm-header .tm-nav a:hover { color:#f9fafb; }
  .tm-right { display:flex; align-items:center; gap:1rem; }
  .tm-actions .tm-btn { padding:0.35rem 0.75rem; border:1px solid #374151; border-radius:0.375rem; color:#e5e7eb; text-decoration:none; font-size:14px; }
  .tm-actions .tm-btn:hover { background:#1f2937; }
  .tm-actions .tm-primary { border-color:#2563eb; background:#2563eb; }
  .tm-actions .tm-primary:hover { background:#1d4ed8; }
  .tm-user { position:relative; }
  .tm-user-btn { padding:0.35rem 0.75rem; border:1px solid #374151; border-radius:0.375rem; color:#e5e7eb; background:#111827; cursor:pointer; font-size:14px; }
  .tm-user-menu { position:absolute; right:0; top:2.25rem; background:#111827; border:1px solid #1f2937; border-radius:0.375rem; min-width:180px; display:none; z-index:50; }
  .tm-user:focus-within .tm-user-menu { display:block; }
  .tm-user-menu a { display:block; padding:0.5rem 0.75rem; color:#e5e7eb; text-decoration:none; font-size:14px; }
  .tm-user-menu a:hover { background:#1f2937; }
  .tm-divider { width:1px; height:18px; background:#374151; margin:0 0.5rem; }
  .tm-nav a.active { color:#f9fafb; }
  .tm-brand small { color:#9ca3af; font-weight:400; font-size:12px; margin-left:6px; }
  .tm-flex { display:flex; align-items:center; gap:.75rem; }
  .tm-nav { display:flex; align-items:center; }
  @media (max-width: 640px){ .tm-nav a { margin-left:.5rem; } }
  .tm-link { color:#9ca3af; }
  .tm-link:hover { color:#f9fafb; }
  .tm-hidden { display:none; }
  .tm-show { display:block; }
  .tm-menu-right { position:relative; }
  .tm-user-menu hr { border:none; border-top:1px solid #1f2937; margin:4px 0; }
</style>
<header class="tm-header">
  <div class="tm-container">
    <a class="tm-brand" href="{{ brand_home_url or '/' }}">
      {% if brand_logo_url %}<img src="{{ brand_logo_url }}" alt="logo" style="height:22px;vertical-align:middle;margin-right:8px;"/>{% endif %}
      {{ brand_name or 'Project Name' }}<small>{{ brand_tag or '' }}</small>
    </a>
    <div class="tm-right"> 
      {% set _nav = nav_items if (nav_items is defined) else [] %}
      {% if _nav and _nav|length > 0 %}
        <nav class="tm-nav" aria-label="Primary"> 
          {% for it in _nav %}
            <a href="{{ it.href }}" class="tm-link{% if it.active %} active{% endif %}">{{ it.label }}</a>
          {% endfor %}
        </nav>
      {% endif %}
      {% if request and request.state and request.state.user %} 
        <div class="tm-user" id="tm-user">
          <button class="tm-user-btn" id="tm-user-btn">Account â–¾</button>
          <div class="tm-user-menu" id="tm-user-menu">
            <a href="/profile">Profile</a>
            <a href="/settings">Settings</a>
            <a href="/words">My Words</a>
            <a href="/stats">Statistics</a>
            <hr />
            <a href="/logout">Log out</a>
          </div>
        </div>
      {% else %}
        <div class="tm-actions">
          <a href="/login" class="tm-btn">Log in</a>
          <a href="/signup" class="tm-btn tm-primary">Sign up</a>
        </div>
      {% endif %}
    </div>
  </div>
</header>
<!-- Dropdown uses CSS :focus-within; no JS needed -->
{% set __persist = persist_header if persist_header is defined else true %}
{% if __persist %}
<script src="https://unpkg.com/htmx.org@1.9.12" integrity="sha384-+bVsx3b8QdE7cO1S4oFQ9hQ1TImfQxWqS4LzJd8j3jL5uFQw8L7f3NfL2hJdJg9w" crossorigin="anonymous"></script>
<script>
// Enable header persistence via htmx: boost links/forms and swap only #arcadia-content
(function(){
  try{
    var b=document.body; if(!b) return;
    b.setAttribute('hx-boost','true');
    b.setAttribute('hx-target','#arcadia-content');
    b.setAttribute('hx-select','#arcadia-content');
    b.setAttribute('hx-swap','innerHTML');
    b.setAttribute('hx-push-url','true');
  }catch(e){}
})();
</script>
<!-- Persistent module hook: re-initialize pages after HTMX swaps (e.g., chart bootstrap) -->
<script type="module">
  const initPage = async () => {
    const chartCanvas = document.getElementById('price-chart');
    if (chartCanvas) {
      try {
        const mod = await import('/static/js/modules/app.js');
        if (!window._arcadia_chart) {
          window._arcadia_chart = mod.bootstrapApp?.();
        }
      } catch (e) { /* ignore */ }
    }
  };
  window.addEventListener('DOMContentLoaded', initPage);
  document.body.addEventListener('htmx:afterSwap', initPage);
  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') initPage();
  });
}</script>
{% endif %}
            