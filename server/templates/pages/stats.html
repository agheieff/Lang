{% extends "layout/base.html" %}

{% block content %}
<div class="container mx-auto max-w-2xl p-4">
  <h1 class="text-2xl font-bold mb-6">Statistics</h1>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
    <!-- Level -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-lg font-semibold mb-4 text-gray-800">Your Level</h2>
      <div class="text-3xl font-bold text-blue-600">{{ "%.1f"|format(profile.level_value or 0) }}</div>
      <div class="text-sm text-gray-600 mt-2">Level Code: {{ profile.level_code or 'Unknown' }}</div>
      <div class="text-xs text-gray-500 mt-1">Uncertainty: {{ "%.2f"|format(profile.level_var or 1.0) }}</div>
    </div>

    <!-- Progress -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-lg font-semibold mb-4 text-gray-800">Learning Progress</h2>
      <div class="space-y-3">
        <div class="flex justify-between items-center">
          <span class="text-gray-600">Total Words</span>
          <span class="font-bold text-gray-900">{{ stats.total_words or 0 }}</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-gray-600">Texts Read</span>
          <span class="font-bold text-gray-900">{{ stats.texts_read or 0 }}</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-gray-600">Words per Text</span>
          <span class="font-bold text-gray-900">{{ stats.words_per_text or 0 }}</span>
        </div>
      </div>
    </div>

    <!-- Words by Level -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-lg font-semibold mb-4 text-gray-800">Words by Level</h2>
      <div class="space-y-2">
        {% if stats.words_by_level %}
          {% for level, count in stats.words_by_level.items()|sort(attribute='0') %}
            <div class="flex justify-between items-center text-sm">
              <span class="text-gray-700">{{ level }}</span>
              <span class="font-semibold text-gray-900">{{ count }}</span>
            </div>
          {% endfor %}
        {% else %}
          <p class="text-gray-500 text-sm">No words yet. Start reading to build your vocabulary!</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Language Info -->
  <div class="mt-6 bg-white rounded-lg shadow-md p-6">
    <h2 class="text-lg font-semibold mb-4 text-gray-800">Language Settings</h2>
    <div class="text-sm text-gray-600">
      <p><strong>Learning:</strong> {{ lang|upper }}</p>
      <p><strong>Target:</strong> English</p>
    </div>
  </div>
</div>

<script>
// Load stats when page loads
document.addEventListener('DOMContentLoaded', async function() {
  try {
    const res = await fetch('/srs/stats', { headers: { 'Accept': 'application/json' } });
    if (res.ok) {
      const stats = await res.json();
      console.log('Stats loaded:', stats);
    }
  } catch (e) {
    console.error('Error loading stats:', e);
  }
});
</script>
{% endblock %}
