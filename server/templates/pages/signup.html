{% extends "layout/base.html" %}

{% block content %}
<div class="container mx-auto max-w-md p-4">
  <h1 class="text-2xl font-bold mb-6 text-center">Sign Up</h1>

  <form hx-post="/auth/register" hx-ext="json-enc" hx-on::after-request="handleSignupResponse(event)" class="bg-white rounded-lg shadow-md p-6 space-y-4">
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
      <input type="email" name="email" class="border border-gray-300 rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500" required>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
      <input type="password" name="password" class="border border-gray-300 rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500" required>
    </div>

    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg w-full transition-colors">
      Sign Up
    </button>

    <div class="text-center">
      <a href="/login" class="text-blue-600 hover:text-blue-700">Already have an account? Log in</a>
    </div>
  </form>

  <div id="signup-result" class="mt-4">
    <!-- Signup result will appear here -->
  </div>
</div>

<script>
function handleSignupResponse(event) {
  if (event.detail.xhr.status === 201) {
    // Registration successful - redirect to profile creation
    window.location.href = '/profile';
  } else if (event.detail.xhr.status >= 400) {
    // Show error
    const resultDiv = document.getElementById('signup-result');
    try {
      const error = JSON.parse(event.detail.xhr.responseText);
      resultDiv.innerHTML = `
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
          ${error.detail || 'Registration failed'}
        </div>
      `;
    } catch {
      resultDiv.innerHTML = `
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
          Registration failed. Please try again.
        </div>
      `;
    }
  }
}
</script>
{% endblock %}